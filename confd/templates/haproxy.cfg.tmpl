global
#    daemon
    log 127.0.0.1 local2
    maxconn 256

defaults
    mode tcp
    timeout connect ${TIMEOUT_CONNECT}
    timeout client  ${TIMEOUT_CLIENT}
    timeout server  ${TIMEOUT_SERVER}
 
    log global

# Get haproxy-config with etcd
 
{{range $dir := lsdir "/"}}
frontend {{$dir}}-in
    bind {{$binddir := printf "/%s/frontend/bind" $dir}}{{getv $binddir}}
    default_backend {{$default_backenddir := printf "/%s/frontend/default_backend" $dir}}{{getv $default_backenddir}}

backend {{$custdir := printf "/%s/frontend/default_backend" $dir}}{{getv $custdir}}
    {{$custdir := printf "/%s/backend/*" $dir}}{{range gets $custdir}}
    server {{base .Key}}  {{.Value}}{{end}}
{{end}}

